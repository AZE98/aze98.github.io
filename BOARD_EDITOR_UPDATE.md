# 小棋盘编辑器 - 更新说明

## 🎉 新功能亮点

### 1. ✨ 像V1一样点击边缘设置墙壁

**旧方式**：选择方向 → 点击格子中心
**新方式**：直接点击格子边缘

```
优势：
✅ 更直观 - 墙壁在哪就点哪
✅ 更快速 - 无需选择方向
✅ 可切换 - 再次点击移除墙壁
✅ 双边同步 - 自动设置相邻格子
```

### 2. 🎨 增强的颜色可视化

#### 分光镜显示
- **彩色边框**：红/黄/蓝/绿
- **半透明背景**：对应颜色10%透明度
- **大图标**：40×40px，清晰可见
- **阴影效果**：文字阴影增强可读性

#### 终点显示
- **圆形边框**：36×36px
- **颜色描边**：2px边框
- **大图标**：28px字体
- **形状清晰**：⭕🔺⬛⬢

### 3. 📊 自动数据排序

所有导出的JSON数据都按照标准格式排序：

```json
{
  "walls": [
    { "x": 0, "y": 0, "sides": ["right", "bottom"] },  // y=0, x=0
    { "x": 1, "y": 0, "sides": ["left"] },             // y=0, x=1
    { "x": 7, "y": 0, "sides": ["right"] },            // y=0, x=7
    { "x": 0, "y": 1, "sides": ["top"] }               // y=1, x=0
    // ... 按y从小到大，x从小到大排序
  ],
  "prisms": [
    { "x": 2, "y": 0, "direction": "\\", "color": "yellow" },
    { "x": 3, "y": 6, "direction": "/", "color": "green" }
  ],
  "targets": [
    { "x": 4, "y": 1, "shape": "square", "color": "blue", "id": "B0F0T1" },
    { "x": 5, "y": 1, "shape": "triangle", "color": "green", "id": "B0F0T2" }
    // ID自动重新生成，保证连续性
  ]
}
```

### 4. 🖱️ 改进的交互逻辑

#### 墙壁工具
- 点击边缘：添加/移除墙壁（toggle）
- 自动同步：相邻格子的对应边也会更新
- 示例：点击(3,2)的右边 → (3,2)加右墙 + (4,2)加左墙

#### 终点/分光镜工具
- 点击格子中心：放置元素
- 覆盖规则：同位置元素会被替换

#### 擦除工具
- 点击边缘：移除该边的墙壁
- 点击中心：移除该格子的所有元素

## 🎯 使用示例

### 示例1：设置墙壁
```
1. 选择"墙壁"工具 🧱
2. 将鼠标移到格子边缘（hover会高亮）
3. 点击边缘 → 墙壁出现
4. 再次点击同一边缘 → 墙壁消失
```

### 示例2：设置分光镜
```
1. 选择"分光镜"工具 💎
2. 选择方向：\ 或 /
3. 选择颜色：红/黄/蓝/绿
4. 点击格子中心 → 分光镜出现，带颜色边框
```

### 示例3：设置终点
```
1. 选择"终点"工具 🎯
2. 选择形状：⭕🔺⬛⬢
3. 选择颜色：红/黄/蓝/绿/彩虹
4. 点击格子中心 → 终点出现，带颜色边框
```

## 🔧 技术细节

### 双边墙壁同步
```javascript
// 点击(3,2)的右边
toggleWall(face, 3, 2, 'right') {
  // 1. 在(3,2)添加/移除右墙
  // 2. 在(4,2)添加/移除左墙（自动）
  // 3. 排序所有墙壁数据
}
```

### 数据排序算法
```javascript
sortWalls(face) {
  face.walls.sort((a, b) => {
    if (a.y !== b.y) return a.y - b.y;  // 先按y
    return a.x - b.x;                   // 再按x
  });
}
```

### ID自动生成
```javascript
sortTargets(face) {
  face.targets.sort((a, b) => {
    if (a.y !== b.y) return a.y - b.y;
    return a.x - b.x;
  });
  
  // 重新生成ID
  face.targets.forEach((target, index) => {
    target.id = `B${boardId}F${faceId}T${index + 1}`;
  });
}
```

## 📱 界面对比

### 旧版（方向按钮）
```
墙壁方向
[↑ 上] [→ 右]
[↓ 下] [← 左]
```

### 新版（直接点击）
```
墙壁设置
点击格子的边缘来添加/移除墙壁
```

## 🎨 视觉效果

### 分光镜
```
原来: 黄色 \（只有颜色文字）
现在: [带黄色边框和背景的方块，中间显示 \]
```

### 终点
```
原来: ⭕（只有emoji）
现在: [带红色圆形边框的⭕，更大更清晰]
```

## ✅ 与board-0.json格式一致

导出的JSON完全符合标准格式：
- ✅ 按y,x排序
- ✅ 墙壁双边设置
- ✅ ID连续编号
- ✅ 数据结构一致

## 🚀 快速开始

1. 打开 `v2/board-editor.html`
2. 选择工具
3. 点击边缘设置墙壁，点击中心设置终点/分光镜
4. 导出JSON
5. 保存到 `v2/data/` 目录

---

**享受更直观的编辑体验！** 🎉

