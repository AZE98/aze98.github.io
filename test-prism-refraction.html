<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>åˆ†å…‰é•œæŠ˜å°„æµ‹è¯•</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    .pass { background: #d4edda; }
    .fail { background: #f8d7da; }
    .diagram { 
      display: inline-block; 
      margin: 10px 20px;
      padding: 10px;
      background: #f0f0f0;
      font-size: 14px;
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <h1>ğŸ”¬ åˆ†å…‰é•œæŠ˜å°„é€»è¾‘æµ‹è¯•</h1>
  <div id="results"></div>

  <script type="module">
    import { Prism } from './src/core/Prism.js';

    const results = [];

    function test(name, fn) {
      try {
        fn();
        results.push({ name, pass: true });
        console.log('âœ“', name);
      } catch (error) {
        results.push({ name, pass: false, error: error.message });
        console.error('âœ—', name, error);
      }
    }

    function assert(condition, message) {
      if (!condition) throw new Error(message);
    }

    // æµ‹è¯• \ åˆ†å…‰é•œ
    console.log('\n=== æµ‹è¯• \\ åˆ†å…‰é•œ ===\n');

    test('\\åˆ†å…‰é•œ: å‘å³â†’å‘ä¸‹', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.calculateRefraction('right');
      assert(result === 'down', `æœŸæœ› downï¼Œå®é™… ${result}`);
    });

    test('\\åˆ†å…‰é•œ: å‘ä¸‹â†’å‘å³', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.calculateRefraction('down');
      assert(result === 'right', `æœŸæœ› rightï¼Œå®é™… ${result}`);
    });

    test('\\åˆ†å…‰é•œ: å‘å·¦â†’å‘ä¸Š', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.calculateRefraction('left');
      assert(result === 'up', `æœŸæœ› upï¼Œå®é™… ${result}`);
    });

    test('\\åˆ†å…‰é•œ: å‘ä¸Šâ†’å‘å·¦', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.calculateRefraction('up');
      assert(result === 'left', `æœŸæœ› leftï¼Œå®é™… ${result}`);
    });

    // æµ‹è¯• / åˆ†å…‰é•œ
    console.log('\n=== æµ‹è¯• / åˆ†å…‰é•œ ===\n');

    test('/åˆ†å…‰é•œ: å‘å³â†’å‘ä¸Š', () => {
      const prism = new Prism(5, 5, '/', 'blue');
      const result = prism.calculateRefraction('right');
      assert(result === 'up', `æœŸæœ› upï¼Œå®é™… ${result}`);
    });

    test('/åˆ†å…‰é•œ: å‘ä¸Šâ†’å‘å³', () => {
      const prism = new Prism(5, 5, '/', 'blue');
      const result = prism.calculateRefraction('up');
      assert(result === 'right', `æœŸæœ› rightï¼Œå®é™… ${result}`);
    });

    test('/åˆ†å…‰é•œ: å‘å·¦â†’å‘ä¸‹', () => {
      const prism = new Prism(5, 5, '/', 'blue');
      const result = prism.calculateRefraction('left');
      assert(result === 'down', `æœŸæœ› downï¼Œå®é™… ${result}`);
    });

    test('/åˆ†å…‰é•œ: å‘ä¸‹â†’å‘å·¦', () => {
      const prism = new Prism(5, 5, '/', 'blue');
      const result = prism.calculateRefraction('down');
      assert(result === 'left', `æœŸæœ› leftï¼Œå®é™… ${result}`);
    });

    // æµ‹è¯•é¢œè‰²åŒ¹é…
    console.log('\n=== æµ‹è¯•é¢œè‰²åŒ¹é…ï¼ˆç›´é€šï¼‰ ===\n');

    test('åŒè‰²æ£‹å­ç›´é€š: redæ£‹å­é‡åˆ°redåˆ†å…‰é•œ', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.refract('right', 'red');
      assert(result === 'right', `æœŸæœ› rightï¼ˆç›´é€šï¼‰ï¼Œå®é™… ${result}`);
    });

    test('å¼‚è‰²æ£‹å­æŠ˜å°„: blueæ£‹å­é‡åˆ°redåˆ†å…‰é•œ', () => {
      const prism = new Prism(5, 5, '\\', 'red');
      const result = prism.refract('right', 'blue');
      assert(result === 'down', `æœŸæœ› downï¼ˆæŠ˜å°„ï¼‰ï¼Œå®é™… ${result}`);
    });

    // æ˜¾ç¤ºç»“æœ
    const resultsDiv = document.getElementById('results');
    const passed = results.filter(r => r.pass).length;
    const total = results.length;
    
    resultsDiv.innerHTML = `
      <h2>æµ‹è¯•ç»“æœ: ${passed}/${total} é€šè¿‡</h2>
      ${results.map(r => `
        <div class="test ${r.pass ? 'pass' : 'fail'}">
          ${r.pass ? 'âœ“' : 'âœ—'} ${r.name}
          ${r.error ? `<br><span style="color: red;">${r.error}</span>` : ''}
        </div>
      `).join('')}
      
      <h2>ğŸ“ æŠ˜å°„å›¾è§£</h2>
      
      <h3>åæ–œæ  \\ åˆ†å…‰é•œ (å·¦ä¸Šâ†’å³ä¸‹)</h3>
      <div class="diagram">
        å‘å³ â†’ \\  â†’ å‘ä¸‹<br>
        å‘ä¸‹ â†’ \\  â†’ å‘å³<br>
        å‘å·¦ â†’ \\  â†’ å‘ä¸Š<br>
        å‘ä¸Š â†’ \\  â†’ å‘å·¦
      </div>
      
      <h3>æ­£æ–œæ  / åˆ†å…‰é•œ (å·¦ä¸‹â†’å³ä¸Š)</h3>
      <div class="diagram">
        å‘å³ â†’ /  â†’ å‘ä¸Š<br>
        å‘ä¸Š â†’ /  â†’ å‘å³<br>
        å‘å·¦ â†’ /  â†’ å‘ä¸‹<br>
        å‘ä¸‹ â†’ /  â†’ å‘å·¦
      </div>
      
      <h2>ğŸ’¡ ç‰©ç†åŸç†</h2>
      <p>æƒ³è±¡å…‰çº¿é‡åˆ°é•œé¢åå°„ï¼š</p>
      <div class="diagram">
        \\ åˆ†å…‰é•œå°±åƒè¿™æ ·çš„é•œé¢ï¼š<br>
        <pre>
          â†“     â†’
           \\
            \\
        â†’    â†“
        </pre>
      </div>
      <div class="diagram">
        / åˆ†å…‰é•œå°±åƒè¿™æ ·çš„é•œé¢ï¼š<br>
        <pre>
        â†“    â†’
          /
         /
        â†’   â†‘
        </pre>
      </div>
    `;

    console.log(`\næµ‹è¯•å®Œæˆ: ${passed}/${total} é€šè¿‡\n`);
  </script>
</body>
</html>

