<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ ¸å¿ƒç±»æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .pass { color: #4ec9b0; }
        .fail { color: #f48771; }
        pre { background: #252526; padding: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ ¸å¿ƒç±»æµ‹è¯•</h1>
    <div id="results"></div>
    
    <script type="module">
        import { Cell } from './src/core/Cell.js';
        import { Prism } from './src/core/Prism.js';
        import { Target } from './src/core/Target.js';
        import { Robot } from './src/core/Robot.js';
        
        const results = document.getElementById('results');
        let passed = 0, failed = 0;
        
        function test(name, fn) {
            try {
                fn();
                results.innerHTML += `<div class="pass">âœ“ ${name}</div>`;
                passed++;
            } catch (e) {
                results.innerHTML += `<div class="fail">âœ— ${name}: ${e.message}</div>`;
                failed++;
            }
        }
        
        // Cell æµ‹è¯•
        test('Cell - åˆ›å»ºå’ŒåŸºæœ¬åŠŸèƒ½', () => {
            const cell = new Cell(5, 10);
            if (cell.x !== 5 || cell.y !== 10) throw new Error('åæ ‡é”™è¯¯');
            if (!cell.isEmpty()) throw new Error('åº”è¯¥ä¸ºç©º');
        });
        
        test('Cell - å¢™å£è®¾ç½®', () => {
            const cell = new Cell(0, 0);
            cell.setWalls(['top', 'right']);
            if (!cell.hasWall('top')) throw new Error('topå¢™å£åº”è¯¥å­˜åœ¨');
            if (!cell.hasWall('right')) throw new Error('rightå¢™å£åº”è¯¥å­˜åœ¨');
            if (cell.hasWall('bottom')) throw new Error('bottomå¢™å£ä¸åº”å­˜åœ¨');
        });
        
        // Prism æµ‹è¯•
        test('Prism - åˆ›å»º', () => {
            const prism = new Prism(3, 4, '\\', 'red');
            if (prism.x !== 3 || prism.y !== 4) throw new Error('åæ ‡é”™è¯¯');
        });
        
        test('Prism - æŠ˜å°„ï¼ˆ\\ æ–¹å‘ï¼‰', () => {
            const prism = new Prism(0, 0, '\\', 'red');
            if (prism.refract('left', 'blue') !== 'down') throw new Error('leftåº”æŠ˜å°„ä¸ºdown');
            if (prism.refract('up', 'blue') !== 'right') throw new Error('upåº”æŠ˜å°„ä¸ºright');
        });
        
        test('Prism - æŠ˜å°„ï¼ˆ/ æ–¹å‘ï¼‰', () => {
            const prism = new Prism(0, 0, '/', 'red');
            if (prism.refract('left', 'blue') !== 'up') throw new Error('leftåº”æŠ˜å°„ä¸ºup');
            if (prism.refract('up', 'blue') !== 'left') throw new Error('upåº”æŠ˜å°„ä¸ºleft');
        });
        
        test('Prism - åŒè‰²ç›´é€š', () => {
            const prism = new Prism(0, 0, '\\', 'red');
            if (prism.refract('left', 'red') !== 'left') throw new Error('åŒè‰²åº”ç›´é€š');
        });
        
        // Target æµ‹è¯•
        test('Target - åˆ›å»º', () => {
            const target = new Target(5, 5, 'circle', 'red', 'T1');
            if (target.id !== 'T1') throw new Error('IDé”™è¯¯');
        });
        
        test('Target - é¢œè‰²åŒ¹é…', () => {
            const target = new Target(5, 5, 'circle', 'red', 'T1');
            if (!target.canAccept('red')) throw new Error('åº”è¯¥æ¥å—çº¢è‰²');
            if (target.canAccept('blue')) throw new Error('ä¸åº”è¯¥æ¥å—è“è‰²');
        });
        
        test('Target - å½©è‰²ç»ˆç‚¹', () => {
            const target = new Target(5, 5, 'circle', 'rainbow', 'T1');
            if (!target.canAccept('red')) throw new Error('å½©è‰²åº”æ¥å—æ‰€æœ‰é¢œè‰²');
            if (!target.canAccept('blue')) throw new Error('å½©è‰²åº”æ¥å—æ‰€æœ‰é¢œè‰²');
        });
        
        // Robot æµ‹è¯•
        test('Robot - åˆ›å»º', () => {
            const robot = new Robot('red', 1, 2);
            if (robot.color !== 'red') throw new Error('é¢œè‰²é”™è¯¯');
            if (robot.x !== 1 || robot.y !== 2) throw new Error('ä½ç½®é”™è¯¯');
        });
        
        test('Robot - ç§»åŠ¨', () => {
            const robot = new Robot('red', 0, 0);
            robot.moveTo(5, 10);
            if (robot.x !== 5 || robot.y !== 10) throw new Error('ç§»åŠ¨åä½ç½®é”™è¯¯');
        });
        
        test('Robot - é‡ç½®', () => {
            const robot = new Robot('red', 0, 0);
            robot.moveTo(5, 10);
            robot.reset();
            if (robot.x !== 0 || robot.y !== 0) throw new Error('é‡ç½®åä½ç½®é”™è¯¯');
        });
        
        test('Robot - æ›¼å“ˆé¡¿è·ç¦»', () => {
            const robot = new Robot('red', 0, 0);
            const dist = robot.manhattanDistance(3, 4);
            if (dist !== 7) throw new Error(`è·ç¦»åº”ä¸º7ï¼Œå®é™…ä¸º${dist}`);
        });
        
        results.innerHTML += `<hr><div>æ€»è®¡: ${passed + failed}, é€šè¿‡: <span class="pass">${passed}</span>, å¤±è´¥: <span class="fail">${failed}</span></div>`;
    </script>
</body>
</html>

